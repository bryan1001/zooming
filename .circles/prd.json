{
  "project": "Zooming",
  "branchName": "circles/beat-reactive-flight",
  "description": "Beat-reactive flight with sharp 90-degree turns, dramatic banking, and varied building visuals",
  "userStories": [
    {
      "id": "US-001",
      "title": "Detect heavy beat shifts for turn triggers",
      "description": "As a system, I need to distinguish heavy beat shifts from regular beats so turns trigger at musically significant moments.",
      "acceptanceCriteria": [
        "Add detectHeavyBeatShift() to beatDetector.ts",
        "Heavy beat shifts require energy spike > 2.5x rolling average (vs 1.5x for regular beats)",
        "Heavy beat shifts also require silence or low energy in the 200ms before the spike",
        "Export onHeavyBeatShift(callback) for subscriptions",
        "Debounce heavy beat shifts to max 1 per 2 seconds",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement sharp 90-degree turn mechanics",
      "description": "As a viewer, I want the camera to make sharp 90-degree turns that feel snappy and responsive.",
      "acceptanceCriteria": [
        "Create src/camera/turnController.ts module",
        "Export executeTurn(direction: 'left' | 'right') that rotates flight direction by exactly 90 degrees",
        "Turn animation completes in 150-200ms (snappy, not gradual)",
        "Flight path regenerates in new direction after turn",
        "Camera maintains constant forward speed during turn",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Add obstacle detection for safe turn timing",
      "description": "As a viewer, I want turns to avoid collisions with buildings.",
      "acceptanceCriteria": [
        "Add canTurnSafely(direction) method to turnController.ts",
        "Raycast in turn direction to check for buildings within 100 units",
        "Also check the post-turn path for 200 units ahead",
        "Return true only if both checks pass",
        "If beat shift triggers but both directions are blocked, skip the turn",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Connect beat shifts to turn execution",
      "description": "As a viewer, I want turns to execute on heavy beat shifts when safe.",
      "acceptanceCriteria": [
        "Subscribe to onHeavyBeatShift in main.ts",
        "On heavy beat shift: check canTurnSafely('left') and canTurnSafely('right')",
        "If one direction is safe, turn that way",
        "If both directions are safe, alternate or choose randomly",
        "If neither is safe, skip the turn (maintain straight flight)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill - turns happen on heavy beats"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Add dramatic banking animation during turns",
      "description": "As a viewer, I want the camera to bank 45+ degrees during turns for a dramatic flight feel.",
      "acceptanceCriteria": [
        "Add camera roll (Z-axis rotation) to turn animation",
        "Bank angle reaches 50 degrees in turn direction",
        "Banking starts 50ms before turn begins (anticipation)",
        "Banking returns to level 100ms after turn completes (follow-through)",
        "Use smooth easing (ease-in-out) for banking animation",
        "Typecheck passes",
        "Verify in browser using dev-browser skill - visible camera tilt during turns"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Add multiple window pattern variations",
      "description": "As a viewer, I want buildings to have different window patterns.",
      "acceptanceCriteria": [
        "Create 4+ distinct window patterns in windowTexture.ts: grid, staggered, vertical-strips, sparse-random",
        "Each building randomly selects one pattern based on seed",
        "No two adjacent buildings (same chunk, neighboring positions) use identical patterns",
        "Typecheck passes",
        "Verify in browser using dev-browser skill - buildings show varied window patterns"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Increase building height and width variation",
      "description": "As a viewer, I want more dramatic variation in building sizes.",
      "acceptanceCriteria": [
        "Update building.ts height range from 10-100 to 15-150 units",
        "Add occasional tall skyscrapers (5% chance, height 150-250 units)",
        "Width/depth range from 8-30 units (up from 5-20)",
        "Use weighted distribution: 60% medium, 30% short, 10% tall",
        "Typecheck passes",
        "Verify in browser using dev-browser skill - visible variety in building sizes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Add building color and material variety",
      "description": "As a viewer, I want buildings to have different colors and material appearances.",
      "acceptanceCriteria": [
        "Create 4 color palettes: cool-blue, warm-amber, neutral-gray, neon-accent",
        "Each building randomly selects a palette based on seed",
        "Add material variation: metalness 0.1-0.5, roughness 0.3-0.8",
        "Ensure adjacent buildings have different colors",
        "Maintain cohesive nighttime aesthetic overall",
        "Typecheck passes",
        "Verify in browser using dev-browser skill - buildings show varied colors/materials"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    }
  ]
}
